<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: OptSimple [RDoc Documentation]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;

    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }

  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }<\/style>" )

  // ]]>
  </script>

</head>
<body>


    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">OptSimple</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>


                <a href="../files/lib/opt_simple_rb.html">

                lib/opt_simple.rb

                </a>


        <br />

            </td>
        </tr>


        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>

                Object

            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">

  <div id="contextContent">

    <div id="description">
      <h1><a href="OptSimple.html">OptSimple</a> provides a very simple interface to command line parsing.</h1>
<p>
There are three methods to define command line parameters:
</p>
<pre>
 flag - a command line switch with no arguments following.

 option - an optional command line parameter with one or more arguments

 argument - a mandatory command line parameter with one or more arguments
</pre>
<p>
Inside the blocks in flag, option, and argument a shortcut function called
&#8216;set_opt&#8217; can be used to set an option that will be returned in
the <a href="OptSimple/Result.html">Result</a>. The
&#8216;accumulate_opt&#8217; method can be used in the option and argument
blocks to create a list of values, and in the flag block to increment a
counter (with verbosity being the classic example).
</p>
<p>
The number of arguments are determined by the &#8216;arity&#8217; of the
block.
</p>
<p>
The order in which the parameters are defined dictate their order on the
command line.
</p>
<p>
User defined help banners, summaries or the whole usage statement can be
defined.
</p>

    </div>

   </div>


    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">

        <a href="#M000014">add_parameter</a>&nbsp;&nbsp;

        <a href="#M000011">argument</a>&nbsp;&nbsp;

        <a href="#M000004">banner</a>&nbsp;&nbsp;

        <a href="#M000008">default_arg_parser</a>&nbsp;&nbsp;

        <a href="#M000012">error</a>&nbsp;&nbsp;

        <a href="#M000009">flag</a>&nbsp;&nbsp;

        <a href="#M000003">help</a>&nbsp;&nbsp;

        <a href="#M000001">new</a>&nbsp;&nbsp;

        <a href="#M000010">option</a>&nbsp;&nbsp;

        <a href="#M000007">parse_opts</a>&nbsp;&nbsp;

        <a href="#M000006">parse_opts!</a>&nbsp;&nbsp;

        <a href="#M000005">register_opts</a>&nbsp;&nbsp;

        <a href="#M000002">summary</a>&nbsp;&nbsp;

        <a href="#M000013">to_s</a>&nbsp;&nbsp;

      </div>
    </div>

  </div>

    <!-- if includes -->

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Class <a href="OptSimple/Argument.html" class="link">OptSimple::Argument</a><br />
Class <a href="OptSimple/Error.html" class="link">OptSimple::Error</a><br />
Class <a href="OptSimple/Flag.html" class="link">OptSimple::Flag</a><br />
Class <a href="OptSimple/InvalidOption.html" class="link">OptSimple::InvalidOption</a><br />
Class <a href="OptSimple/MissingArgument.html" class="link">OptSimple::MissingArgument</a><br />
Class <a href="OptSimple/Option.html" class="link">OptSimple::Option</a><br />
Class <a href="OptSimple/Parameter.html" class="link">OptSimple::Parameter</a><br />
Class <a href="OptSimple/ParameterUsageError.html" class="link">OptSimple::ParameterUsageError</a><br />
Class <a href="OptSimple/Result.html" class="link">OptSimple::Result</a><br />

    </div>



    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>

        <tr class="top-aligned-row context-row">
          <td class="context-item-name">args</td>

          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>

          <td class="context-item-desc"></td>
        </tr>

        <tr class="top-aligned-row context-row">
          <td class="context-item-name">mandatory_opts</td>

          <td class="context-item-value">&nbsp;[R]&nbsp;</td>

          <td class="context-item-desc"></td>
        </tr>

        <tr class="top-aligned-row context-row">
          <td class="context-item-name">optional_opts</td>

          <td class="context-item-value">&nbsp;[R]&nbsp;</td>

          <td class="context-item-desc"></td>
        </tr>

        </table>
      </div>
    </div>


    <!-- if method_list -->

    <div id="methods">

      <h3 class="section-bar">Public Class methods</h3>


      <div id="method-M000001" class="method-detail">
        <a name="M000001"></a>

        <div class="method-heading">

          <a href="#M000001" class="method-signature">

          <span class="method-name">new</span><span class="method-args">(defaults = {},args = ARGV)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
default keys should should be strings, args can be any list of strings, but
defaults to ARGV
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000001-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000001-source">
<pre>
<span class="ruby-comment cmt"># File lib/opt_simple.rb, line 30</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">defaults</span> = {},<span class="ruby-identifier">args</span> = <span class="ruby-constant">ARGV</span>)
    <span class="ruby-ivar">@mandatory_opts</span> = []
    <span class="ruby-ivar">@optional_opts</span> = []
    <span class="ruby-ivar">@parameters</span> = []
    <span class="ruby-ivar">@param_names</span> = {}
    <span class="ruby-ivar">@results</span> = <span class="ruby-constant">OptSimple</span><span class="ruby-operator">::</span><span class="ruby-constant">Result</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-ivar">@longest_switch_len</span> = <span class="ruby-value">0</span> 
    <span class="ruby-ivar">@defaults</span> = <span class="ruby-identifier">defaults</span>
    <span class="ruby-ivar">@args</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">to_a</span> <span class="ruby-comment cmt"># especially for jruby</span>
    <span class="ruby-ivar">@banner</span> = <span class="ruby-node">&quot;Usage: #{File.basename($0)} [options]&quot;</span>
    <span class="ruby-ivar">@summary</span> = <span class="ruby-value str">&quot;&quot;</span>
    <span class="ruby-ivar">@help</span> = <span class="ruby-value str">&quot;&quot;</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <h3 class="section-bar">Public Instance methods</h3>


      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">

          <a href="#M000014" class="method-signature">

          <span class="method-name">add_parameter</span><span class="method-args">(parm)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
You probably don&#8217;t want to call this method. A lower level function
that adds a <a href="OptSimple/Flag.html">Flag</a>, <a
href="OptSimple/Option.html">Option</a>, or <a
href="OptSimple/Argument.html">Argument</a>,
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000014-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000014-source">
<pre>
<span class="ruby-comment cmt"># File lib/opt_simple.rb, line 284</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_parameter</span>(<span class="ruby-identifier">parm</span>)
    
    <span class="ruby-ivar">@longest_switch_len</span> = <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">switch_len</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">switch_len</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@longest_switch_len</span>

    <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">names</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">|</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@param_names</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">n</span>)
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">OptSimple</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span> <span class="ruby-value str">&quot;Command line switch already in use!&quot;</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-ivar">@param_names</span>[<span class="ruby-identifier">n</span>] = <span class="ruby-keyword kw">true</span>
      <span class="ruby-keyword kw">end</span>

    <span class="ruby-keyword kw">end</span>
    <span class="ruby-ivar">@parameters</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">parm</span>
    <span class="ruby-ivar">@mandatory_opts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">parm</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">mandatory?</span>
    <span class="ruby-ivar">@optional_opts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">parm</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">mandatory?</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">

          <a href="#M000011" class="method-signature">

          <span class="method-name">argument</span><span class="method-args">(switches,help=&quot;&quot;,metavar=&quot;ARG&quot;,&amp;block)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
Registers a mandatory parameter, with one or more argument following it.
&#8216;switches&#8217; can be a String or an Array of Strings, and
specifies the switches expected on the CL. &#8216;help&#8217; provides a
description of the parameter, and &#8216;metavar&#8217; will be used in the
usage statement. and an optional block can do parameter
validation/transformation. If no block is given, then the strings specified
(after the leading &#8217;-&#8217;s removed) will be used as keys in the <a
href="OptSimple/Result.html">Result</a> and the values set to the arg
following the switch the args array.
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
<span class="ruby-comment cmt"># File lib/opt_simple.rb, line 244</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">argument</span>(<span class="ruby-identifier">switches</span>,<span class="ruby-identifier">help</span>=<span class="ruby-value str">&quot;&quot;</span>,<span class="ruby-identifier">metavar</span>=<span class="ruby-value str">&quot;ARG&quot;</span>,<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">add_parameter</span>(<span class="ruby-constant">Argument</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">switches</span>,<span class="ruby-identifier">help</span>,<span class="ruby-identifier">metavar</span>,<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>))
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000004" class="method-detail">
        <a name="M000004"></a>

        <div class="method-heading">

          <a href="#M000004" class="method-signature">

          <span class="method-name">banner</span><span class="method-args">(str)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
set the banner to str, overriding the default: &#8220;Usage:
#{File.basename($0)} [options]&#8220;
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000004-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000004-source">
<pre>
<span class="ruby-comment cmt"># File lib/opt_simple.rb, line 55</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">banner</span>(<span class="ruby-identifier">str</span>)
    <span class="ruby-ivar">@banner</span> = <span class="ruby-identifier">str</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">

          <a href="#M000008" class="method-signature">

          <span class="method-name">default_arg_parser</span><span class="method-args">()</span>

          </a>

        </div>

        <div class="method-description">

          <p>
You do not want to call this function. This provides a default behavior for
all switches on the command line if no block is given to <a
href="OptSimple.html#M000007">parse_opts</a>
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
<span class="ruby-comment cmt"># File lib/opt_simple.rb, line 186</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">default_arg_parser</span> 
    <span class="ruby-identifier">flag</span> = <span class="ruby-keyword kw">nil</span>
    <span class="ruby-ivar">@args</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span>,<span class="ruby-identifier">loc</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arg</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'--'</span>
        <span class="ruby-comment cmt"># end of flag marker</span>
        <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">positional_args</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@args</span>[<span class="ruby-identifier">loc</span><span class="ruby-operator">+</span><span class="ruby-value">1</span> <span class="ruby-operator">..</span> <span class="ruby-value">-1</span>]
        <span class="ruby-keyword kw">break</span>
      <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">arg</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^-+(.*)/</span>
        <span class="ruby-comment cmt"># assume flags are boolean</span>
        <span class="ruby-ivar">@results</span>[<span class="ruby-identifier">$1</span>] = <span class="ruby-keyword kw">true</span>
        <span class="ruby-identifier">flag</span> = <span class="ruby-identifier">$1</span>
      <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">flag</span>
        <span class="ruby-comment cmt"># unless followed by an arg</span>
        <span class="ruby-ivar">@results</span>[<span class="ruby-identifier">flag</span>] = <span class="ruby-identifier">arg</span>
        <span class="ruby-identifier">flag</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">positional_args</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-ivar">@args</span>.<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">not</span> <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">positional_args</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">a</span>)}
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">

          <a href="#M000012" class="method-signature">

          <span class="method-name">error</span><span class="method-args">(string=nil)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
A shortcut for raising an <a
href="OptSimple/Error.html">OptSimple::Error</a> exception
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
<span class="ruby-comment cmt"># File lib/opt_simple.rb, line 249</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">error</span>(<span class="ruby-identifier">string</span>=<span class="ruby-keyword kw">nil</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">OptSimple</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">string</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">

          <a href="#M000009" class="method-signature">

          <span class="method-name">flag</span><span class="method-args">(switches,help=&quot;&quot;,&amp;block)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
Registers an optional parameter, usually with nothing following it. If not
set on the CL, it will be false in the <a
href="OptSimple/Result.html">Result</a>. &#8216;switches&#8217; can be a
String or an Array of Strings, and specifies the switches expected on the
CL. &#8216;help&#8217; provides a description of the parameter and an
optional block can do parameter validation/transformation. If no block is
given, then the strings specified (after the leading &#8217;-&#8217;s
removed) will be used as keys in the <a
href="OptSimple/Result.html">Result</a> and the values set to true when
seen on the CL
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
<span class="ruby-comment cmt"># File lib/opt_simple.rb, line 216</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">flag</span>(<span class="ruby-identifier">switches</span>,<span class="ruby-identifier">help</span>=<span class="ruby-value str">&quot;&quot;</span>,<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">parm</span> = <span class="ruby-constant">Flag</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">switches</span>,<span class="ruby-identifier">help</span>,<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">add_parameter</span>(<span class="ruby-identifier">parm</span>)

    <span class="ruby-comment cmt"># use the first name b/c they are all aliased anyways.</span>
    <span class="ruby-ivar">@defaults</span>[<span class="ruby-identifier">parm</span>.<span class="ruby-identifier">names</span>.<span class="ruby-identifier">first</span>] = <span class="ruby-keyword kw">false</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000003" class="method-detail">
        <a name="M000003"></a>

        <div class="method-heading">

          <a href="#M000003" class="method-signature">

          <span class="method-name">help</span><span class="method-args">(str)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
provide a user defined help string, and override the auto-generated one
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000003-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000003-source">
<pre>
<span class="ruby-comment cmt"># File lib/opt_simple.rb, line 50</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">help</span>(<span class="ruby-identifier">str</span>)
    <span class="ruby-ivar">@help</span> = <span class="ruby-identifier">str</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">

          <a href="#M000010" class="method-signature">

          <span class="method-name">option</span><span class="method-args">(switches,help=&quot;&quot;,metavar=&quot;ARG&quot;,&amp;block)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
Registers an optional parameter, with one or more argument following it.
&#8216;switches&#8217; can be a String or an Array of Strings, and
specifies the switches expected on the CL. &#8216;help&#8217; provides a
description of the parameter, and &#8216;metavar&#8217; will be used in the
usage statement. and an optional block can do parameter
validation/transformation. If no block is given, then the strings specified
(after the leading &#8217;-&#8217;s removed) will be used as keys in the <a
href="OptSimple/Result.html">Result</a> and the values set to the arg
following the switch on the CL.
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
<span class="ruby-comment cmt"># File lib/opt_simple.rb, line 232</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">option</span>(<span class="ruby-identifier">switches</span>,<span class="ruby-identifier">help</span>=<span class="ruby-value str">&quot;&quot;</span>,<span class="ruby-identifier">metavar</span>=<span class="ruby-value str">&quot;ARG&quot;</span>,<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">add_parameter</span>(<span class="ruby-constant">Option</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">switches</span>,<span class="ruby-identifier">help</span>,<span class="ruby-identifier">metavar</span>,<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>))
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">

          <a href="#M000007" class="method-signature">

          <span class="method-name">parse_opts</span><span class="method-args">(&amp;block)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
Parse the options in a non-destructive way to the args array passed in. If
no block is given, then a default parser with no error checking will be
run.
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
<span class="ruby-comment cmt"># File lib/opt_simple.rb, line 177</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_opts</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-ivar">@original_args</span> = <span class="ruby-ivar">@args</span> <span class="ruby-comment cmt"># do I really need these around?</span>
    <span class="ruby-ivar">@args</span> = <span class="ruby-ivar">@args</span>.<span class="ruby-identifier">dup</span>
    <span class="ruby-identifier">parse_opts!</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000006" class="method-detail">
        <a name="M000006"></a>

        <div class="method-heading">

          <a href="#M000006" class="method-signature">

          <span class="method-name">parse_opts!</span><span class="method-args">(&amp;block)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
Parse the options, destructively pulling them out of the args array as it
goes. If no block is given, then a default parser with no error checking
will be run.
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000006-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000006-source">
<pre>
<span class="ruby-comment cmt"># File lib/opt_simple.rb, line 70</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_opts!</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
      <span class="ruby-identifier">register_opts</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-keyword kw">end</span>

    <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@parameters</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-comment cmt">#parse the @args array by looking for switches/args by regex</span>
      <span class="ruby-identifier">default_arg_parser</span>
    <span class="ruby-keyword kw">else</span>
      <span class="ruby-comment cmt"># add the help option at the end, but only use -h if it hasn't been used</span>
      <span class="ruby-comment cmt"># already (cuz we're that nice).</span>
      <span class="ruby-identifier">help_strings</span> = <span class="ruby-node">%w[-h --help]</span>
      <span class="ruby-keyword kw">if</span>(<span class="ruby-ivar">@parameters</span>.<span class="ruby-identifier">find</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">switches</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">'-h'</span>)})
        <span class="ruby-identifier">help_strings</span> = <span class="ruby-node">%w[--help]</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">flag</span> <span class="ruby-identifier">help_strings</span> ,<span class="ruby-value str">&quot;(for this help message)&quot;</span>

      <span class="ruby-comment cmt"># go through the  registered parameters, and pull out </span>
      <span class="ruby-comment cmt"># the specified parms from @arg</span>

      <span class="ruby-comment cmt"># first look for a call for help</span>
      <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">help_strings</span> <span class="ruby-operator">&amp;</span> <span class="ruby-ivar">@args</span>).<span class="ruby-identifier">empty?</span>
        <span class="ruby-identifier">$stdout</span>.<span class="ruby-identifier">puts</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_s</span>
        <span class="ruby-identifier">exit</span>(<span class="ruby-value">0</span>)
      <span class="ruby-keyword kw">end</span>
      
      <span class="ruby-identifier">mandatory_check</span> = <span class="ruby-identifier">mandatory_opts</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">switches</span>}
      
      <span class="ruby-identifier">positional_args</span> = []
      <span class="ruby-keyword kw">if</span>(<span class="ruby-identifier">loc</span> = <span class="ruby-ivar">@args</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">'--'</span>))
        <span class="ruby-comment cmt">#remove the '--', but don't include it w/ positional arguments</span>
        <span class="ruby-identifier">positional_args</span> = <span class="ruby-ivar">@args</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-identifier">loc</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>)[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
      <span class="ruby-keyword kw">end</span>
      
      <span class="ruby-comment cmt"># Handle the case where a user specifies --foo=bar, or --foo=bar,baz</span>
      <span class="ruby-identifier">equal_args</span> = <span class="ruby-ivar">@args</span>.<span class="ruby-identifier">find_all</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">'='</span>) }
      <span class="ruby-ivar">@args</span>.<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">'='</span>) }
      <span class="ruby-identifier">equal_args</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">e</span> <span class="ruby-operator">|</span>
        <span class="ruby-identifier">switch</span>,<span class="ruby-identifier">list</span> = <span class="ruby-identifier">e</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'='</span>)
        <span class="ruby-ivar">@args</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">switch</span>
        <span class="ruby-identifier">list</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">','</span>).<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span> <span class="ruby-ivar">@args</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">val</span> }
      <span class="ruby-keyword kw">end</span>
      
      <span class="ruby-comment cmt"># now actually parse the args, and call all the stored up blocks from the options</span>
      <span class="ruby-ivar">@parameters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">parm</span> <span class="ruby-operator">|</span>
        <span class="ruby-identifier">intersection</span> = <span class="ruby-ivar">@args</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">switches</span>
        
        <span class="ruby-comment cmt"># load the defaults for this particular parm no matter what is on the CL</span>
        <span class="ruby-identifier">default_switches</span> = <span class="ruby-ivar">@defaults</span>.<span class="ruby-identifier">keys</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">names</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">default_switches</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
          <span class="ruby-identifier">raise</span> <span class="ruby-constant">OptSimple</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span> <span class="ruby-node">&quot;Clashes in the defaults for #{parm.switches}&quot;</span>
        <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">default_switches</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
          <span class="ruby-comment cmt"># set the default value before we see what is on the CL</span>
          <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">param_options</span>[<span class="ruby-identifier">default_switches</span>.<span class="ruby-identifier">first</span>] = <span class="ruby-ivar">@defaults</span>[<span class="ruby-identifier">default_switches</span>.<span class="ruby-identifier">first</span>]
          <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">merge!</span> <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">param_options</span>
        <span class="ruby-keyword kw">end</span>

        <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">intersection</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-identifier">mandatory_check</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">parm</span>.<span class="ruby-identifier">switches</span>)
          
          <span class="ruby-identifier">arg_locations</span> =  []
          <span class="ruby-ivar">@args</span>.<span class="ruby-identifier">each_with_index</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">arg</span>,<span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">arg_locations</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">i</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">intersection</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">arg</span>) }
          
          <span class="ruby-comment cmt"># we want to process the args in order to provide predictable behavior</span>
          <span class="ruby-comment cmt"># in the case of switch duplication. </span>
          <span class="ruby-comment cmt"># We do pull them out in reverse so that the slicing removes pieces from the end </span>
          <span class="ruby-comment cmt"># of @args, so we don't disrupt the other locations, but put them into 'chunks'</span>
          <span class="ruby-comment cmt"># backwards to restore their order. </span>
          <span class="ruby-identifier">chunks</span> = []
          <span class="ruby-identifier">arg_locations</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">loc</span><span class="ruby-operator">|</span>  
            <span class="ruby-identifier">chunks</span>.<span class="ruby-identifier">unshift</span> <span class="ruby-ivar">@args</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-identifier">loc</span> <span class="ruby-operator">..</span> <span class="ruby-identifier">loc</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">block</span>.<span class="ruby-identifier">arity</span>)[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
          <span class="ruby-keyword kw">end</span>
          
          <span class="ruby-identifier">chunks</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">pieces</span> <span class="ruby-operator">|</span>
            <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pieces</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">block</span>.<span class="ruby-identifier">arity</span> <span class="ruby-keyword kw">or</span>
                <span class="ruby-identifier">pieces</span>.<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-value str">'-'</span>)}
              <span class="ruby-identifier">raise</span> <span class="ruby-constant">OptSimple</span><span class="ruby-operator">::</span><span class="ruby-constant">ParameterUsageError</span>.<span class="ruby-identifier">new</span> <span class="ruby-node">&quot;Not enough args following #{intersection}&quot;</span>,<span class="ruby-keyword kw">self</span> 
            <span class="ruby-keyword kw">end</span>
            
            <span class="ruby-keyword kw">begin</span>
              <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">instance_exec</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">pieces</span>,<span class="ruby-operator">&amp;</span><span class="ruby-identifier">parm</span>.<span class="ruby-identifier">block</span>)
            <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">OptSimple</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
              <span class="ruby-identifier">raise</span> <span class="ruby-constant">OptSimple</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>,<span class="ruby-keyword kw">self</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">merge!</span> <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">param_options</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
      
      <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">mandatory_check</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">MissingArgument</span>.<span class="ruby-identifier">new</span> <span class="ruby-node">&quot;Must set the following parameters: #{mandatory_check.map {|a| a.join(' OR ')}.join(', ')}&quot;</span>,<span class="ruby-keyword kw">self</span>
      <span class="ruby-keyword kw">end</span>
      
      <span class="ruby-identifier">extra_switches</span> = <span class="ruby-ivar">@args</span>.<span class="ruby-identifier">find_all</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-value str">'-'</span>) }
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">OptSimple</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidOption</span>.<span class="ruby-identifier">new</span> <span class="ruby-node">&quot;Unknown options: #{extra_switches.join(' ')}&quot;</span>,<span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">extra_switches</span>.<span class="ruby-identifier">empty?</span>

      <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">positional_args</span> = <span class="ruby-ivar">@args</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">positional_args</span>
      <span class="ruby-comment cmt"># put back the positional args that were taken off after the '--'</span>
      <span class="ruby-ivar">@args</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">positional_args</span>)
    <span class="ruby-keyword kw">end</span>

    <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@results</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000005" class="method-detail">
        <a name="M000005"></a>

        <div class="method-heading">

          <a href="#M000005" class="method-signature">

          <span class="method-name">register_opts</span><span class="method-args">(&amp;block)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
Simply register options without actually parsing them. This allows
registering parms in multiple places in your code.
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000005-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000005-source">
<pre>
<span class="ruby-comment cmt"># File lib/opt_simple.rb, line 61</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">register_opts</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-comment cmt"># call the block to register all the parameters and</span>
    <span class="ruby-comment cmt"># their corresponding code blocks</span>
    <span class="ruby-comment cmt"># We use instance_exec so that the API is cleaner. </span>
    <span class="ruby-identifier">instance_exec</span>(<span class="ruby-ivar">@results</span>,<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) 
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000002" class="method-detail">
        <a name="M000002"></a>

        <div class="method-heading">

          <a href="#M000002" class="method-signature">

          <span class="method-name">summary</span><span class="method-args">(str)</span>

          </a>

        </div>

        <div class="method-description">

          <p>
set the Summary string at the end of the usage statement
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000002-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000002-source">
<pre>
<span class="ruby-comment cmt"># File lib/opt_simple.rb, line 45</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">summary</span>(<span class="ruby-identifier">str</span>)
    <span class="ruby-ivar">@summary</span> = <span class="ruby-identifier">str</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>


      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">

          <a href="#M000013" class="method-signature">

          <span class="method-name">to_s</span><span class="method-args">()</span>

          </a>

        </div>

        <div class="method-description">

          <p>
returns the automatic usage statement
</p>

          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
<span class="ruby-comment cmt"># File lib/opt_simple.rb, line 254</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@help</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">help_str</span> = <span class="ruby-value str">&quot;&quot;</span>
      
      <span class="ruby-identifier">help_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;  MANDATORY ARGS:\n&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">mandatory_opts</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">mandatory_opts</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">parm</span> <span class="ruby-operator">|</span>
        <span class="ruby-identifier">help_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">help_str</span>(<span class="ruby-ivar">@longest_switch_len</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n\n&quot;</span>
      <span class="ruby-keyword kw">end</span> 
      
      <span class="ruby-identifier">help_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;  OPTIONS:\n&quot;</span> <span class="ruby-keyword kw">unless</span>  <span class="ruby-identifier">optional_opts</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">optional_opts</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">parm</span> <span class="ruby-operator">|</span>
        <span class="ruby-identifier">help_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">help_str</span>(<span class="ruby-ivar">@longest_switch_len</span>)
        
        <span class="ruby-comment cmt"># check to see if we have any defaults set to help in the help doc</span>
        <span class="ruby-identifier">intersection</span> = <span class="ruby-ivar">@defaults</span>.<span class="ruby-identifier">keys</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">parm</span>.<span class="ruby-identifier">names</span>
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">intersection</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-identifier">help_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n\n&quot;</span>
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-identifier">help_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; (default is #{@defaults[intersection.first]})\n\n&quot;</span>
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">help_str</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  SUMMARY:\n\n    #{@summary}\n\n&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@summary</span>.<span class="ruby-identifier">empty?</span>
      
      <span class="ruby-ivar">@help</span> = <span class="ruby-ivar">@banner</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\n\n&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">help_str</span> 
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-ivar">@help</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>

        </div>
      </div>



    </div>




  </div>

<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>
